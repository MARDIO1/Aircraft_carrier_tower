# 增强版地面站功能说明

## 概述

增强版地面站系统在原有关闭/开启功能的基础上，新增了风扇转速控制、舵机角度控制以及专业级的可视化界面。系统现在支持完整的双向数据通信，包括传感器数据实时显示和可视化状态指示。

## 新增功能

### 1. 风扇转速控制
- **控制范围**: 0-1000 RPM
- **可视化指示**: 颜色编码状态指示器
  - 0 RPM: 灰色 (停止)
  - 1-299 RPM: 绿色 (低速)
  - 300-699 RPM: 黄色 (中速)
  - 700-1000 RPM: 红色 (高速)

### 2. 舵机角度控制
- **控制范围**: 0-180° (4个独立舵机)
- **可视化指示**: 角度条和颜色编码
  - 90°: 绿色 (中性位置)
  - 80-100°: 蓝色 (接近中性)
  - 60-79° 或 101-120°: 黄色 (中等偏移)
  - 其他角度: 红色 (极限位置)

### 3. 可视化状态指示器
- **连接状态**: 圆形指示灯 (绿色=已连接，红色=未连接)
- **系统状态**: 状态条指示器
  - 红色: 未连接
  - 绿色: 已连接
  - 蓝色: 运行中

### 4. 传感器数据显示
- **陀螺仪**: gx, gy, gz (°/s)
- **加速度计**: ax, ay, az (g)
- **磁力计**: mx, my, mz (μT)
- **实时更新**: 100ms更新频率

## 协议升级

### 上行数据包 (地面站 → 制导镖)
- **长度**: 14字节
- **结构**:
  ```
  Header(1) + Switch(1) + Fan_RPM(2) + Servo[4](8) + Tail(1) + CRC(1)
  ```
- **示例**: `AA 01 F4 00 5A 00 5A 00 5A 00 5A BB 3C`

### 下行数据包 (制导镖 → 地面站)
- **长度**: 40字节
- **结构**:
  ```
  Header(1) + Last_Switch(1) + Gyro[9](36) + Tail(1) + CRC(1)
  ```
- **传感器数据**: 陀螺仪、加速度计、磁力计各3轴

## 文件结构

```
Aircraft_carrier_tower-main/
├── src/
│   ├── main.py                    # 主程序 (已更新使用增强版GUI)
│   ├── GUI_enhanced.py           # 增强版GUI界面
│   ├── protocol.py               # 通信协议 (已升级)
│   ├── playerInput.py            # 玩家输入处理 (已升级)
│   ├── initial.py                # 串口初始化
│   └── GUI.py                    # 原始GUI (保留兼容性)
├── demo_enhanced_gui.py          # 增强版GUI演示脚本
├── test_enhanced_features.py     # 功能测试脚本
└── ENHANCED_FEATURES.md          # 本文档
```

## 使用方法

### 1. 运行增强版主程序
```bash
cd Aircraft_carrier_tower-main
python src/main.py
```

### 2. 运行演示程序 (无硬件要求)
```bash
python demo_enhanced_gui.py
```

### 3. 运行功能测试
```bash
python test_enhanced_features.py
```

## 操作指南

### 基本操作流程
1. **连接串口**: 选择COM端口并点击"连接"
2. **系统控制**: 使用滑块调整系统开关状态
3. **风扇控制**: 调整风扇转速滑块 (0-1000 RPM)
4. **舵机控制**: 调整4个舵机角度滑块 (0-180°)
5. **发送数据**: 使用"发送完整数据"按钮发送所有控制参数
6. **监控状态**: 观察可视化指示器和传感器数据

### 控制按钮功能
- **发送完整数据**: 发送开关、风扇转速、舵机角度的完整数据包
- **发送控制数据**: 仅发送开关状态
- **开启系统**: 快速开启系统
- **关闭系统**: 快速关闭系统
- **重置控制**: 将所有控制重置为默认值
- **清空历史**: 清空传感器历史数据

## 兼容性说明

### 向后兼容
- 原有的简单命令 (3字节) 仍然支持
- 原有的GUI界面仍然可用
- 协议层自动检测数据包类型

### 向前兼容
- 新的完整数据包格式
- 扩展的传感器数据支持
- 可视化状态指示

## 技术特性

### 数据完整性
- **CRC-8校验**: 确保数据传输的可靠性
- **缓冲区管理**: 处理数据流，避免数据丢失
- **错误处理**: 完善的异常处理机制

### 实时性能
- **100ms更新**: 实时数据刷新
- **多线程**: 非阻塞UI操作
- **高效渲染**: 优化的Canvas绘制

### 用户体验
- **直观界面**: 专业级的可视化设计
- **颜色编码**: 快速状态识别
- **实时反馈**: 即时操作响应

## 故障排除

### 常见问题
1. **串口连接失败**: 检查端口号和权限
2. **数据发送失败**: 检查硬件连接和波特率
3. **GUI无响应**: 检查Python环境和依赖

### 调试工具
- 使用 `test_enhanced_features.py` 验证功能
- 查看控制台输出获取详细信息
- 使用演示程序测试无硬件环境

## 扩展开发

### 添加新功能
1. 在 `protocol.py` 中扩展协议
2. 在 `playerInput.py` 中添加输入处理
3. 在 `GUI_enhanced.py` 中添加UI组件

### 自定义界面
- 修改颜色方案
- 调整布局和尺寸
- 添加新的可视化元素

---

**版本**: 1.0  
**最后更新**: 2025-11-21  
**开发者**: 增强版地面站团队
