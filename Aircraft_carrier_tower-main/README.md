# 航模地面站控制系统

一个功能完整的Python航模地面站应用程序，通过UART串口与航模硬件进行双向通信，提供专业级的可视化控制界面和实时状态监控。

## 🚀 主要特性

### 核心功能
- **串口通信**: 支持UART串口通信，波特率115200，可配置COM端口
- **双向数据通信**: 完整的上下行数据包协议，支持实时控制指令和传感器数据接收
- **增强版GUI界面**: 专业级的可视化控制面板，支持实时状态指示和数据可视化
- **键盘输入支持**: 集成键盘快捷键控制，提升操作便捷性

### 系统控制
- **系统开关控制**: 一键开启/关闭航模系统
- **风扇转速控制**: 0-1000 RPM精确控制，带可视化状态指示
- **舵机角度控制**: 4个独立舵机控制，0-180°范围，实时角度显示
- **传感器数据监控**: 实时显示陀螺仪、加速度计、磁力计数据

### 可视化界面
- **连接状态指示**: 实时连接状态可视化（绿色=已连接，红色=未连接）
- **系统状态指示**: 状态条显示系统运行状态
- **风扇状态指示**: 颜色编码显示风扇转速状态
- **舵机角度指示**: 角度条和颜色编码显示舵机位置
- **高级数据日志**: 表格样式日志显示，支持过滤和搜索

## 📁 项目结构

```
Aircraft_carrier_tower-main/
├── src/
│   ├── main.py                    # 主程序入口，集成增强版GUI
│   ├── GUI_enhanced.py           # 增强版GUI界面（主要界面）
│   ├── protocol.py               # 通信协议处理，支持完整数据包
│   ├── playerInput.py            # 键盘输入捕获和处理
│   ├── initial.py                # 串口初始化和配置
│   └── GUI.py                    # 原始GUI界面（保留兼容性）
├── demo_enhanced_gui.py          # 增强版GUI演示脚本
├── demo_enhanced_features.py     # 增强功能演示脚本
├── ENHANCED_FEATURES.md          # 增强功能详细说明
├── 增强功能实现总结.md            # 功能实现总结文档
├── pyproject.toml                # 项目配置和依赖管理
└── uv.lock                       # 依赖锁定文件
```

## 🛠️ 安装指南

### 前置要求
- Python 3.8 或更高版本
- Windows/Linux/macOS 操作系统
- 串口设备（航模硬件）

### 使用uv包管理器安装

1. **创建虚拟环境**
   ```bash
   uv venv
   ```

2. **激活虚拟环境**
   - Windows:
     ```bash
     .venv\Scripts\Activate.ps1
     ```
   - Linux/macOS:
     ```bash
     source .venv/bin/activate
     ```

3. **安装依赖**
   ```bash
   uv pip install pyserial pynput
   ```

### 使用传统pip安装
```bash
pip install pyserial pynput
```

## 🎮 使用方法

### 启动应用程序
```bash
python src/main.py
```

### 操作流程

1. **连接串口**
   - 在GUI界面中输入正确的COM端口（如COM3）
   - 点击"连接"按钮建立串口连接
   - 使用"扫描端口"按钮查看可用端口

2. **系统控制**
   - **开关控制**: 使用系统开关按钮或滑块控制航模系统开启/关闭
   - **风扇控制**: 调整风扇转速滑块（0-1000 RPM）
   - **舵机控制**: 调整4个舵机角度滑块（0-180°）

3. **数据发送**
   - **发送完整数据**: 发送开关、风扇转速、舵机角度的完整数据包
   - **发送控制数据**: 仅发送系统开关状态
   - **开启/关闭系统**: 快速发送系统开启或关闭命令

4. **状态监控**
   - 观察可视化指示器了解系统状态
   - 查看传感器数据实时更新
   - 监控数据日志了解通信状态

### 控制参数说明

#### 系统开关
- **范围**: 0.0-1.0
- **功能**: 控制航模系统总开关
- **阈值**: >0.1为开启状态

#### 风扇转速
- **范围**: 0-1000 RPM
- **状态指示**:
  - 0 RPM: 灰色（停止）
  - 1-299 RPM: 绿色（低速）
  - 300-699 RPM: 黄色（中速）
  - 700-1000 RPM: 红色（高速）

#### 舵机角度
- **范围**: 0-180°
- **状态指示**:
  - 90°: 绿色（中性位置）
  - 80-100°: 蓝色（接近中性）
  - 60-79° 或 101-120°: 黄色（中等偏移）
  - 其他角度: 红色（极限位置）

## 📡 通信协议

### 上行数据包（地面站 → 航模）
- **长度**: 14字节
- **结构**: `Header(1) + Switch(1) + Fan_RPM(2) + Servo[4](8) + Tail(1) + CRC(1)`
- **示例**: `AA 01 F4 00 5A 00 5A 00 5A 00 5A BB 3C`

| 字段 | 长度 | 说明 |
|------|------|------|
| Header | 1字节 | 0xAA |
| Switch | 1字节 | 系统开关（0=关，1=开） |
| Fan_RPM | 2字节 | 风扇转速（0-1000） |
| Servo[4] | 8字节 | 4个舵机角度（0-180） |
| Tail | 1字节 | 0xBB |
| CRC | 1字节 | CRC-8校验和 |

### 下行数据包（航模 → 地面站）
- **长度**: 40字节
- **结构**: `Header(1) + Last_Switch(1) + Gyro[9](36) + Tail(1) + CRC(1)`

| 字段 | 长度 | 说明 |
|------|------|------|
| Header | 1字节 | 0xCC |
| Last_Switch | 1字节 | 上次开关状态 |
| Gyro[9] | 36字节 | 传感器数据（陀螺仪、加速度计、磁力计各3轴） |
| Tail | 1字节 | 0xDD |
| CRC | 1字节 | CRC-8校验和 |

### 传感器数据
- **陀螺仪**: gx, gy, gz（°/s）
- **加速度计**: ax, ay, az（g）
- **磁力计**: mx, my, mz（μT）

## 🔧 开发指南

### 代码架构

#### 主程序 (main.py)
- 初始化各模块（协议、串口、输入捕获）
- 启动增强版GUI界面
- 资源管理和异常处理

#### 增强版GUI (GUI_enhanced.py)
- 可视化控制界面
- 实时状态指示器
- 高级数据日志系统
- 传感器数据显示

#### 通信协议 (protocol.py)
- 数据包编码/解码
- CRC校验计算
- 缓冲区管理
- 兼容性支持

#### 串口初始化 (initial.py)
- 串口设备检测
- 连接管理
- 数据发送/接收

#### 输入捕获 (playerInput.py)
- 键盘输入处理
- 控制参数更新
- 快捷键支持

### 扩展开发

#### 添加新功能
1. 在 `protocol.py` 中扩展协议数据结构
2. 在 `playerInput.py` 中添加输入处理逻辑
3. 在 `GUI_enhanced.py` 中添加UI组件和事件处理

#### 自定义界面
- 修改颜色方案和布局
- 添加新的可视化元素
- 调整控件尺寸和位置

### 调试工具

#### 演示程序
```bash
# 运行增强版GUI演示（无硬件要求）
python demo_enhanced_gui.py

# 运行功能测试
python demo_enhanced_features.py
```

#### 日志功能
- 高级数据日志支持过滤和搜索
- 日志导出功能
- 实时状态监控

## 🐛 故障排除

### 常见问题

1. **串口连接失败**
   - 检查COM端口是否正确
   - 确认串口设备权限
   - 验证波特率设置（115200）

2. **数据发送失败**
   - 检查硬件连接
   - 验证协议格式
   - 查看控制台错误信息

3. **GUI无响应**
   - 检查Python环境
   - 验证依赖包安装
   - 查看系统资源使用

4. **传感器数据显示异常**
   - 检查数据包完整性
   - 验证CRC校验
   - 确认硬件传感器状态

### 调试步骤

1. **基础连接测试**
   - 使用"扫描端口"功能确认设备识别
   - 检查设备管理器中的串口状态

2. **协议验证**
   - 使用演示程序测试无硬件环境
   - 查看数据日志确认通信状态

3. **性能优化**
   - 调整更新频率（默认100ms）
   - 优化缓冲区大小
   - 监控内存使用

## 📊 技术特性

### 数据完整性
- **CRC-8校验**: 使用CRC-8/MAXIM算法确保数据传输可靠性
- **缓冲区管理**: 智能缓冲区处理，避免数据丢失
- **错误处理**: 完善的异常处理机制

### 实时性能
- **100ms更新频率**: 实时数据刷新
- **非阻塞UI**: 多线程处理，确保界面响应
- **高效渲染**: 优化的Canvas绘制性能

### 用户体验
- **直观界面**: 专业级的可视化设计
- **颜色编码**: 快速状态识别
- **实时反馈**: 即时操作响应
- **高级日志**: 强大的数据记录和分析功能

## 🔄 兼容性说明

### 向后兼容
- 支持原有的3字节简单命令格式
- 保留原始GUI界面功能
- 协议层自动检测数据包类型

### 向前兼容
- 完整的14字节上行数据包
- 40字节下行数据包支持
- 扩展的传感器数据格式
- 增强的可视化功能

## 📄 许可证

本项目采用开源许可证，具体信息请查看LICENSE文件。

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 📞 支持

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 查看项目文档

---

**版本**: 1.0.0  
**最后更新**: 2025-11-23  
**开发者**: 航模地面站开发团队
